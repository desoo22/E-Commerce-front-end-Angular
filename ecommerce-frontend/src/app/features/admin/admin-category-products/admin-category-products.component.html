<div class="admin-category-products-container">
  <div class="header">
    <div class="header-left">
      <a routerLink="/admin/categories" class="back-link">‚Üê Back to Categories</a>
      <h1>{{ categoryName }} Products</h1>
    </div>
    <button class="btn-primary" (click)="addProduct()">+ Add Product</button>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>
  <div *ngIf="error" class="alert alert-error">{{ error }}</div>

  <!-- Add/Edit Product Form -->
  <div *ngIf="showAddForm" class="product-form-modal">
    <div class="product-form">
      <h2>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h2>
      
      <div class="form-group">
        <label>Product Name *</label>
        <input type="text" [(ngModel)]="newProduct.name" placeholder="Enter product name" />
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea [(ngModel)]="newProduct.description" placeholder="Enter product description" rows="4"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Price *</label>
          <input type="number" [(ngModel)]="newProduct.price" placeholder="0.00" min="0" step="0.01" />
        </div>

        <div class="form-group">
          <label>Variant Price</label>
          <input type="number" [(ngModel)]="newProduct.variantPrice" placeholder="0.00" min="0" step="0.01" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Stock Quantity</label>
          <input type="number" [(ngModel)]="newProduct.variantQuantity" placeholder="10" min="0" />
        </div>

        <div class="form-group">
          <label>Color</label>
          <input type="text" [(ngModel)]="newProduct.variantColor" placeholder="e.g., Red, Blue" />
        </div>

        <div class="form-group">
          <label>Size</label>
          <input type="text" [(ngModel)]="newProduct.variantSize" placeholder="e.g., M, L, XL" />
        </div>
      </div>

      <div class="form-group">
        <label>Product Images</label>
        <input type="file" (change)="onImageSelected($event)" accept="image/*" multiple />
        <div *ngIf="imagePreviews.length > 0" class="image-previews">
          <img *ngFor="let preview of imagePreviews" [src]="preview" alt="Preview" />
        </div>
      </div>

      <div class="form-actions">
        <button class="btn-secondary" (click)="cancelEdit()">Cancel</button>
        <button class="btn-primary" (click)="saveProduct()">{{ editingProduct ? 'Update' : 'Create' }}</button>
      </div>
    </div>
  </div>

  <!-- Products List -->
  <div *ngIf="loading" class="loading">Loading products...</div>

  <div *ngIf="!loading && products.length === 0" class="empty-state">
    <p>No products found in this category.</p>
    <button class="btn-primary" (click)="addProduct()">Add First Product</button>
  </div>

  <div *ngIf="!loading && products.length > 0" class="products-grid">
    <div *ngFor="let product of products" class="product-card">
      <div class="product-image">
        <img *ngIf="product.images && product.images.length > 0" 
             [src]="(typeof product.images[0] === 'string' ? product.images[0] : (product.images[0]?.imageData || product.images[0]?.imageUrl))" 
             [alt]="product.name" />
        <img *ngIf="!product.images || product.images.length === 0" 
             src="assets/placeholder.png" 
             alt="No image" />
        <span class="stock-badge" [ngClass]="getStockClass(product)">
          {{ getStockStatus(product) }}
        </span>
      </div>
      
      <div class="product-info">
        <h3>{{ product.name }}</h3>
        <p class="product-description">{{ product.description }}</p>
        <div class="product-meta">
          <span class="price">${{ product.price }}</span>
          <span class="stock">Stock: {{ getStockCount(product) }}</span>
        </div>
      </div>

      <div class="product-actions">
        <button class="btn-edit" (click)="editProduct(product)">Edit</button>
        <button class="btn-delete" (click)="deleteProduct(product.id)">Delete</button>
      </div>
    </div>
  </div>
</div>
